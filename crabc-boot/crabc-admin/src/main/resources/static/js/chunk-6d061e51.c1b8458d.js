(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6d061e51"],{"12fd":function(e,t,a){"use strict";var i=a("2909"),n=(a("a9e3"),a("99af"),a("4de4"),a("d3b7"),a("d81d"),a("ceac")),o=a.n(n),s=[{dataIndex:"title",title:"接口编号",width:150},{dataIndex:"nickname",title:"接口名称",width:200}],r=[{dataIndex:"title",title:"接口编号",width:150},{dataIndex:"nickname",title:"接口名称",width:200}],l=[{dataIndex:"title",title:"应用名称",width:200}],c=[{dataIndex:"title",title:"应用名称",width:200}],d={inject:["reload"],props:{pageNum:{type:Number,default:1},pageSize:{type:Number,default:5},total:{type:Number,default:0},editRecord:{type:Object,default:function(){return{}}},openType:{type:String,default:""}},data:function(){return{formLayout:"horizontal",form:this.$form.createForm(this,{name:"coordinated"}),lableTitle:"",mockData:[],targetKeys:[],disabled:!1,showSearch:!0,leftColumns:"empower"==this.openType?l:s,rightColumns:"empower"==this.openType?c:r,rightSuccess:!1,leftSuccess:!1,pageNum:1,pageSize:2,total:0,leftData:[],rightData:[],allData:[]}},created:function(){switch(this.openType){case"Consumer":this.listRelationLeft(),this.listRelationRight(),this.lableTitle="应用名称";break;case"DataRole":this.getDataRoleLeft(),this.getDataRoleRight(),this.lableTitle="角色名称";break;case"empower":this.getEmpoweErData()}},mounted:function(){var e=this;setTimeout((function(){e.allData=e.leftData.concat(e.rightData);var t=[],a=[];e.allData.filter((function(a){"empower"==e.openType?t.push({key:a.consumerId,title:a.consumerName,nickname:a.nickname}):t.push({key:a.apiId,title:a.apiId,nickname:a.apiName})})),e.rightData.filter((function(t){"empower"==e.openType?a.push({key:t.consumerId,title:t.consumerName,nickname:t.nickname}):a.push({key:t.apiId,title:t.apiId,nickname:t.apiName})})),e.mockData=t,e.originTargetKeys=a.map((function(e){return e.key})),e.targetKeys=e.originTargetKeys}),500),setTimeout((function(){switch(e.openType){case"Consumer":e.form.setFieldsValue({groupName:e.editRecord.appName});break;case"DataRole":e.form.setFieldsValue({groupName:e.editRecord.roleName})}}),500)},methods:{handleSubmit:function(){var e=this;this.form.validateFields((function(t,a){if(!t)switch(e.openType){case"Consumer":e.relationUser();break;case"DataRole":e.relationUserDataRole();break;case"empower":e.editPowerList()}}))},onChange:function(e){this.targetKeys=e},onSearch:function(e){this.$refs.transfers.sourceSelectedKeys=[]},handleSelectChange:function(e,t){this.selectedKeys=[].concat(Object(i.a)(e),Object(i.a)(t))},pageChange:function(){this.$refs.transfers.sourceSelectedKeys=[]},triggerDisable:function(e){this.disabled=e},triggerShowSearch:function(e){this.showSearch=e},getRowSelection:function(e){var t=e.disabled,a=e.selectedKeys,i=e.itemSelectAll,n=e.itemSelect;return{getCheckboxProps:function(e){return{props:{disabled:t||e.disabled}}},onSelectAll:function(e,t){var n=t.filter((function(e){return!e.disabled})).map((function(e){return e.key})),s=e?o()(n,a):o()(a,n);i(s,e)},onSelect:function(e,t){var a=e.key;n(a,t)},selectedRowKeys:a}},listRelationLeft:function(){var e=this,t={appId:this.editRecord.appId,appName:this.editRecord.appName,keyName:this.searchName,pageNum:1,pageSize:this.pageSize};this.$api.account.chooseList(t).then((function(t){e.leftData=t.data.list,e.total=t.data.total,e.leftSuccess=!0}))},listRelationRight:function(){var e=this,t={appId:this.editRecord.appId,appName:this.editRecord.appName,keyName:this.searchName,pageNum:1,pageSize:this.pageSize};this.$api.account.choosed(t).then((function(t){e.rightData=t.data.list,e.total=t.data.total,e.rightSuccess=!0}))},relationUser:function(){var e=this,t={appId:this.editRecord.appId,apiIds:this.targetKeys};this.$api.account.addChoose(t).then((function(t){e.$message.success(t.data),e.reload()}))},getDataRoleLeft:function(){var e=this,t={roleId:this.editRecord.roleId,pageNum:1,pageSize:this.pageSize};this.$api.datarole.getDataRoleLeft(t).then((function(t){e.leftData=t.data.list,e.leftSuccess=!0}))},getDataRoleRight:function(){var e=this,t={roleId:this.editRecord.roleId,pageNum:1,pageSize:this.pageSize};this.$api.datarole.getDataRoleRight(t).then((function(t){e.rightData=t.data.list,e.rightSuccess=!0}))},getEmpoweErData:function(){var e=this,t={apiId:this.editRecord.apiId,apiCode:this.editRecord.apiCode};this.$api.serInterface.powerList(t).then((function(t){e.leftData=t.data.availableConsumer,e.rightData=t.data.authedConsumer,e.leftSuccess=!0,e.rightSuccess=!0}))},editPowerList:function(){var e=this,t={apiId:this.editRecord.apiId,apiCode:this.editRecord.apiCode,consumerIds:this.targetKeys};this.$api.serInterface.editPowerList(t).then((function(t){e.$message.success(t.data),e.$emit("closeModal",!0)}))},relationUserDataRole:function(){var e=this,t={roleId:this.editRecord.roleId,userIds:this.targetKeys};this.$api.datarole.relationUserDataRole(t).then((function(t){e.$message.success(t.data),e.reload()}))}}},u=a("2877"),p=Object(u.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-transfer",{ref:"transfers",attrs:{titles:"empower"!=e.openType?["可授权API","已授权API"]:["可授权应用","已授权应用"],"data-source":e.mockData,"target-keys":e.targetKeys,disabled:e.disabled,"show-search":e.showSearch,"filter-option":function(e,t){return t.title&&-1!==t.title.indexOf(e)||t.nickname&&-1!==t.nickname.indexOf(e)},"show-select-all":!1},on:{selectChange:e.handleSelectChange,change:e.onChange,search:e.onSearch},scopedSlots:e._u([{key:"children",fn:function(t){var i=t.props,n=i.direction,o=i.filteredItems,s=i.selectedKeys,r=i.disabled,l=t.on,c=l.itemSelectAll,d=l.itemSelect;return[a("a-table",{style:{pointerEvents:r?"none":null},attrs:{"row-selection":e.getRowSelection({disabled:r,selectedKeys:s,itemSelectAll:c,itemSelect:d}),columns:"left"===n?e.leftColumns:e.rightColumns,"data-source":o,size:"small","custom-row":function(e){var t=e.key,a=e.disabled;return{on:{click:function(){a||r||d(t,!s.includes(t))}}}},scroll:{x:(e.openType,200)}},on:{change:e.pageChange}})]}}])})],1)}),[],!1,null,null,null);t.a=p.exports},"1c5f":function(e,t,a){"use strict";a("f861")},2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var i=a("6b75");var n=a("06c5");function o(e){return function(e){if(Array.isArray(e))return Object(i.a)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Object(n.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},"2eaa":function(e,t,a){var i=a("d612"),n=a("8db3"),o=a("5edf"),s=a("7948"),r=a("b047f"),l=a("c584");e.exports=function(e,t,a,c){var d=-1,u=n,p=!0,h=e.length,f=[],m=t.length;if(!h)return f;a&&(t=s(t,r(a))),c?(u=o,p=!1):t.length>=200&&(u=l,p=!1,t=new i(t));e:for(;++d<h;){var g=e[d],y=null==a?g:a(g);if(g=c||0!==g?g:0,p&&y==y){for(var b=m;b--;)if(t[b]===y)continue e;f.push(g)}else u(t,y,c)||f.push(g)}return f}},"47d5":function(e,t,a){"use strict";a.r(t);a("cd17");var i=a("ed3b"),n=(a("d81d"),a("99af"),a("12fd")),o=a("5118"),s={inject:["reload"],components:{AssociatedUser:n.a},data:function(){return{apiDatasourceList:[],popData:{},selectVal:"全部",totalPage:3,server_falg:!0,order_option:!1,ser_value:this.indexGroupId||"",ser_val_data:{},expand:!1,daddyTabType:"",auditId:"",ModalGive:!1,openType:"empower",rowData:[],comsumerSelList:[],order_form:{apiGroupId:"",apiName:"",apiDesc:"",auditStatus:"WAIT_AUDIT",submitTimeStart:"",submitTimeEnd:"",pageNo:1,pageSize:10},order_form_app:{apiGroupId:"",apiName:"",apiDesc:"",auditStatus:"WAIT_AUDIT",submitTimeStart:"",submitTimeEnd:"",auditType:"",pageNo:1,pageSize:10},order_form2:{groupId:"",apiName:"",apiDesc:"",keyword:"",datasourceCode:"",isPublish:"",isOpen:"",isDestroy:"N",pageNo:1,pageSize:10},order_form_index:{groupId:this.indexGroupId||"",apiName:this.searchName||"",apiDesc:"",consumerId:"",beginTime:"",endTime:"",pageNo:1,pageSize:10},pageNo:1,pageSize:10,total:0,totalNum:0,appName:"",submitType:"",batchDelData:[],editRecord:{},columns:[{title:"服务编号",dataIndex:"apiCode",key:"apiCode",width:100},{title:"服务名称",dataIndex:"apiName",key:"apiName",scopedSlots:{customRender:"apiName"},width:250},{title:"服务分组",dataIndex:"apiGroupName",key:"apiGroupName",width:200},{title:"申请人",dataIndex:"submitByName",key:"submitByName",width:150},2==this.tabKey?{title:"应用",dataIndex:"consumerName",key:"consumerName",width:200}:"",{title:"申请时间",dataIndex:"submitTime",key:"submitTime",width:200},{title:"审批状态",dataIndex:"auditStatus",key:"auditStatus",scopedSlots:{customRender:"auditStatus"},width:200},{title:"审批人",dataIndex:"auditBy",key:"auditBy",width:150},{title:"审批意见",dataIndex:"auditMsg",key:"auditMsg",ellipsis:!0,width:200},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:150}],colForApiManage:[{title:"服务编号",dataIndex:"apiCode",key:"apiCode",fixed:"left",width:100},{title:"服务名称",dataIndex:"apiName",key:"apiName",scopedSlots:{customRender:"apiName"},width:200,fixed:"left"},{title:"服务分组",dataIndex:"groupName",key:"groupName",width:180,ellipsis:!0},{title:"数据源标识",dataIndex:"datasourceName",key:"datasourceName",scopedSlots:{customRender:"datasourceName"},width:180,ellipsis:!0},{title:"开发人",dataIndex:"createByName",key:"createByName",width:100},{title:"发布状态",dataIndex:"isPublish",key:"isPublish",scopedSlots:{customRender:"isPublish"},width:100},{title:"开放状态",dataIndex:"isOpen",key:"isOpen",scopedSlots:{customRender:"isOpen"},width:100},{title:"服务状态",dataIndex:"isDestroy",key:"isDestroy",customRender:function(e){return"Y"==e?"已销毁":"正常"},width:100},{title:"服务级别",dataIndex:"serveLevel",key:"serveLevel",scopedSlots:{customRender:"serveLevel"},width:100},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:170},{title:"控制策略",dataIndex:"operation2",scopedSlots:{customRender:"operation2"},width:330}],columns3:[{title:"服务编号",dataIndex:"apiCode",key:"apiCode",width:100},{title:"服务名称",dataIndex:"apiName",key:"apiName",scopedSlots:{customRender:"apiName"},width:250},{title:"服务描述",dataIndex:"apiDesc",key:"apiDesc",width:250},{title:"服务分组",dataIndex:"groupName",key:"groupName",width:200},{title:"开放时间",dataIndex:"openTime",key:"openTime",width:200},{title:"服务状态",dataIndex:"apiStatus",key:"apiStatus",scopedSlots:{customRender:"apiStatus"},width:200},{title:"可调用消费方",dataIndex:"consumerName",key:"consumerName",width:200,ellipsis:!0},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:250}],colForAppAuthorization:[{title:"应用ID",dataIndex:"appId",key:"appId",width:100},{title:"应用名称",dataIndex:"appName",key:"appName",scopedSlots:{customRender:"appName"},width:200},{title:"业务系统",dataIndex:"projectName",key:"projectName",width:200},{title:"申请类型",dataIndex:"auditType",key:"auditType",scopedSlots:{customRender:"auditType"},width:100},{title:"申请人",dataIndex:"submitByName",key:"submitByName",width:150},{title:"申请时间",dataIndex:"submitTime",key:"submitTime",width:200},{title:"审批状态",dataIndex:"auditStatus",key:"auditStatus",scopedSlots:{customRender:"auditStatus"},width:150},{title:"审批人",dataIndex:"auditBy",key:"auditBy",width:150},{title:"审批意见",dataIndex:"auditMsg",key:"auditMsg",ellipsis:!0,width:200},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:150}],colForDevAuthorization:[{title:"申请人",dataIndex:"submitByName",key:"submitByName",width:150},{title:"申请人所在部门",dataIndex:"orgName",key:"orgName",width:200},{title:"申请时间",dataIndex:"submitTime",key:"submitTime",width:200},{title:"审批状态",dataIndex:"auditStatus",key:"auditStatus",scopedSlots:{customRender:"auditStatus"},width:150},{title:"审批人",dataIndex:"auditBy",key:"auditBy",width:150},{title:"审批意见",dataIndex:"auditMsg",key:"auditMsg",ellipsis:!0,width:200},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:200}],tabData:[],isShow:!1,tepTwo:!1,controlStrategyModal:!1,controlStrategyTitle:"",visibleServeLevel:!1,formServe:{apiCode:1,serveLevel:void 0},confirmLoading:!1,ruleFormServeLevel:{serveLevel:[{required:!0,message:"请选择服务级别",trigger:"blur"}]},strategyFormData:{}}},props:["tabType","serManagement","searchName","indexGroupId","tabKey"],computed:{pagination:function(){var e=this;Math.ceil(e.total/e.pageSize);return{showSizeChanger:!0,size:"small",pageSizeOptions:["10","20","50","100"],showQuickJumper:!0,pageSize:e.pageSize,total:e.totalNum,current:e.pageNo,showTotal:function(t){return"共 ".concat(e.total," 条")},onChange:function(t,a){e.pageNo=t,e.pageSize=a,"ser_approval"==e.tabType?2==e.tabKey?(e.order_form.pageNo=t,e.order_form.pageSize=a,e.getCallList()):1==e.tabKey?(e.order_form.pageNo=t,e.order_form.pageSize=a,e.getPubList()):3==e.tabKey?(e.order_form.pageNo=t,e.order_form.pageSize=a,e.auditConsumer()):4==e.tabKey&&(e.order_form.pageNo=t,e.order_form.pageSize=a,e.serveAuditList()):"serInterface"==e.tabType?(e.order_form2.pageNo=t,e.order_form2.pageSize=a,e.getSerAppList()):(e.order_form_index.pageNo=t,e.order_form_index.pageSize=a,e.getindexSerList())},onShowSizeChange:function(e,t){this.onChange(1,t)}}}},created:function(){"ser_approval"==this.tabType&&"3"==this.tabKey&&this.$set(this.order_form,"auditType","");var e=this.$route.query.apiCode;e&&e.length>0&&(this.order_form2.keyword=e),this.getSelArr(),this.getApiDatasourceList(),this.selectList()},mounted:function(){this.init()},methods:{init:function(){"ser_approval"==this.tabType?"2"==this.tabKey?this.getCallList():"1"==this.tabKey?this.getPubList():"3"==this.tabKey?this.auditConsumer():"4"==this.tabKey&&this.serveAuditList():"serInterface"==this.tabType?this.getSerAppList():this.getindexSerList()},onDatasourceChange:function(e,t){this.order_form2.datasourceCode=e},fbStatus:function(e,t){this.order_form2.isPublish=e},spStatus:function(e,t){this.order_form.auditStatus=e},appStatus:function(e,t){this.order_form.auditType=e},kfStatus:function(e,t){this.order_form2.isOpen=e},fwStatus:function(e,t){this.order_form2.isDestroy=e},canUseConsumer:function(e,t){this.order_form_index.consumerId=e},getApiDatasourceList:function(){var e=this;this.$api.serInterface.apiDatasourceList().then((function(t){e.apiDatasourceList=t.data||[]}))},getSelArr:function(){var e=this;this.$api.serApproval.getAllSelArr().then((function(t){null!=t.code&&0==t.code&&(e.ser_val_data=t.data)}))},getPubList:function(){var e=this;this.$api.serApproval.getPubList(this.order_form).then((function(t){0==t.code&&(e.tabData=t.data.list,e.total=t.data.total,e.totalNum=t.data.total)}))},getCallList:function(){var e=this;this.$api.serApproval.getCallList(this.order_form).then((function(t){0==t.code&&(e.tabData=t.data.list,e.total=t.data.total,e.totalNum=t.data.total)}))},auditConsumer:function(){var e=this,t={appName:this.order_form.apiName,auditType:this.order_form.auditType,auditStatus:this.order_form.auditStatus,stateTime:this.order_form.submitTimeStart,endTime:this.order_form.submitTimeEnd,currentPage:this.order_form.pageNo,pageSize:this.order_form.pageSize};this.$api.serApproval.auditConsumer(t).then((function(t){if(0==t.code){var a=JSON.parse(JSON.stringify(t.data.list)),i=[],n=[];n=JSON.parse(JSON.stringify(t.data.list)),a.map((function(e){e.auditBody?i.push(JSON.parse(e.auditBody)):i.push({})}));for(var o=0;o<n.length;o++)n[o]=Object.assign(n[o],i[o]);e.tabData=n,e.total=t.data.total,e.totalNum=t.data.total}}))},serveAuditList:function(){var e=this,t={userName:this.order_form.apiName,auditStatus:this.order_form.auditStatus,stateTime:this.order_form.submitTimeStart,endTime:this.order_form.submitTimeEnd,currentPage:this.order_form.pageNo,pageSize:this.order_form.pageSize};this.$api.serApproval.serveAuditList(t).then((function(t){0==t.code&&(e.tabData=t.data.list,e.total=t.data.total,e.totalNum=t.data.total)}))},getindexSerList:function(){var e=this;this.$api.indexOpenSer.getindexSerList(this.order_form_index).then((function(t){0==t.code&&(e.tabData=t.data.list,e.total=t.data.total,e.totalNum=t.data.total)}))},selectList:function(){var e=this;this.$api.indexOpenSer.selectList({appName:"",pageNo:1,pageSize:10}).then((function(t){0==t.code&&(e.comsumerSelList=t.data.list)}))},getSerAppList:function(){var e=this;this.$api.serInterface.getSerAppList(this.order_form2).then((function(t){0==t.code&&(e.tabData=t.data.list.map((function(e){return e.isPublish="Y"===e.isPublish,e.isOpen="Y"===e.isOpen,e})),e.total=t.data.total,e.totalNum=t.data.total)}))},server_arrChange:function(e){this.order_form.apiGroupId=e.target.value,this.order_form2.groupId=e.target.value,this.order_form_index.groupId=e.target.value},toggle:function(){this.expand=!this.expand},time_rangeChange:function(e,t){this.order_form.submitTimeStart=t[0],this.order_form.submitTimeEnd=t[1],this.order_form_index.beginTime=t[0]?t[0]+" 00:00:00":"",this.order_form_index.endTime=t[1]?t[1]+" 00:00:00":""},approval_btn:function(e){var t=this;this.auditId=e.auditId,this.editRecord=e,this.isShow=!1,this.popData=e,Object(o.setTimeout)((function(){t.isShow=!0}),100)},give_btn:function(e){this.ModalGive=!0,this.editRecord=e},testResult_btn:function(e){this.$api.serviceDetail.goTestResult(e.apiId,e.apiCode,"3")},del_btn:function(e){var t=this;i.a.confirm({title:"是否销毁当前服务？销毁后将无法继续使用该服务！",onOk:function(){var a={apiId:e.apiId,apiCode:e.apiCode};t.$api.serInterface.delSer(a).then((function(e){0==e.code&&(Object(o.setTimeout)((function(){t.$message.success(e.data)}),500),t.reload())}))},onCancel:function(){}})},apply_btn:function(e){var t=this;this.editRecord=e,this.tepTwo=!1,Object(o.setTimeout)((function(){t.tepTwo=!0}),100)},isPublishChange:function(e,t){var a=e?"下":"上",n=this;i.a.confirm({title:"是否"+a+"线当前服务？",onOk:function(){var e={apiId:t.apiId,apiCode:t.apiCode,optionType:t.isPublish?"Y":"N"};n.$api.serInterface.statusPublish(e).then((function(e){0==e.code||(t.isPublish=!t.isPublish)})).catch((function(){t.isPublish=!t.isPublish}))},onCancel:function(){t.isPublish=!t.isPublish}})},isOpenChange:function(e,t){var a=e?"关闭":"开放",n=this;i.a.confirm({title:"是否"+a+"当前服务？",onOk:function(){var e={apiId:t.apiId,apiCode:t.apiCode,optionType:t.isOpen?"Y":"N"};n.$api.serInterface.statusOpen(e).then((function(e){0==e.code||(t.isOpen=!t.isOpen)})).catch((function(){t.isOpen=!t.isOpen}))},onCancel:function(){t.isOpen=!t.isOpen}})},ModalGiveBtn:function(){this.$refs.serGivePowerData.handleSubmit()},closeModal:function(e){e&&(this.ModalGive=!1,this.getSerAppList())},controlStrategyBtn:function(e,t){this.strategyFormData={type:t.type,apiId:e.apiId,apiCode:e.apiCode},this.controlStrategyTitle=t.title,this.controlStrategyModal=!0},order_search:function(e){this.pageNo=1,"ser_approval"==this.tabType?(this.order_form.pageNo=1,2==this.tabKey?this.getCallList():1==this.tabKey?this.getPubList():3==this.tabKey?this.auditConsumer():4==this.tabKey&&this.serveAuditList()):"serInterface"==this.tabType?(this.order_form2.pageNo=1,this.getSerAppList()):(this.order_form_index.pageNo=1,this.getindexSerList())},detail:function(e){if("1"==this.tabKey||"2"==this.tabKey||"serInterface"===this.tabType){var t="".concat(window.location.origin,"/api-details?objId=").concat(e.apiId,"&parentObjId=").concat(e.apiCode,"&objType=API&apiType=").concat("ser_approval"==this.tabType?"":"New");window.open(t,"_blank")}else"3"==this.tabKey&&this.$router.push({name:"DataServiceApplication"})},viewDevConfig:function(e){var t="".concat(window.location.origin,"/data-service?apiId=").concat(e.apiId,"&apiCode=").concat(e.apiCode);window.open(t,"_blank")},groupClick:function(e){this.selectVal=e;var t="全部"==e?e="":e;this.pageNo=1,this.order_form.apiGroupId=t,1==this.tabKey&&"ser_approval"==this.tabType&&this.getPubList(),2==this.tabKey&&"ser_approval"==this.tabType&&this.getCallList(),"index"==this.tabType&&(this.order_form_index.groupId=t,this.getindexSerList()),"serInterface"==this.tabType&&(this.order_form2.pageNo=1,this.order_form2.groupId=t,this.getSerAppList())},submitBtnFun:function(e){"pass"==e.submitBtnFun&&(2==this.tabKey?this.getCallList():this.getPubList())},showServeLevel:function(e){this.formServe.apiCode=e.apiCode||"",this.formServe.serveLevel=e.serveLevel||void 0,this.visibleServeLevel=!0},handleServeLevelOk:function(){var e=this;this.$refs.ruleForm.validate((function(t){t&&(e.confirmLoading=!0,e.$api.serviceDetail.saveServeLevel(e.formServe).then((function(t){e.$message.success("保存成功"),e.confirmLoading=!1,e.visibleServeLevel=!1,e.reload()})).catch((function(t){e.confirmLoading=!1})))}))}}},r=(a("1c5f"),a("2877")),l=Object(r.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"consumer-components-box"},[a("div",{staticClass:"consumer-components-head"},["ser_approval"==e.tabType||"3"==e.tabKey&&"4"==e.tabKey?e._e():a("div",{staticClass:"ser_approval_boxcss",style:{borderStyle:(e.expand,"none none dashed none")}},[a("div",{staticClass:"ser_approval_boxcs_left",staticStyle:{"margin-top":"4px"}},[e._v("服务分组：")]),a("div",{staticClass:"ser_approval_boxcs_center",class:{"show-more":e.expand}},[a("a-radio-group",{staticClass:"server_arr_css",attrs:{"button-style":"solid",name:"radioGroup"},on:{change:e.server_arrChange},model:{value:e.ser_value,callback:function(t){e.ser_value=t},expression:"ser_value"}},[a("a-radio-button",{class:{isSelect:"全部"==e.selectVal&&!this.indexGroupId},on:{click:function(t){return e.groupClick("全部")}}},[e._v("全部")]),e._l(e.ser_val_data,(function(t,i){return a("a-radio-button",{key:i,attrs:{value:t.groupId},on:{click:function(a){return e.groupClick(t.groupId)}}},[e._v(" "+e._s(t.groupName)+" ")])}))],2)],1),a("div",{staticClass:"ser_approval_boxcs_right"},[a("a",{staticClass:"toggleBtn",on:{click:e.toggle}},[e._v(" "+e._s(e.expand?"收起":"展开")+" "),a("a-icon",{staticStyle:{"margin-left":"8px"},attrs:{type:e.expand?"up":"down"}})],1)])]),a("div",{staticClass:"order_form_boxcss"},[a("div",[a("a-form",{attrs:{form:"index"==e.tabType?e.order_form_index:"ser_approval"==e.tabType?e.order_form:e.order_form2,layout:"inline"}},["ser_approval"!==e.tabType?a("a-form-item",[e._v("其他选项：")]):e._e(),"index"==e.tabType?a("a-form-item",{attrs:{label:"服务名称："}},[a("a-input",{attrs:{placeholder:"请输入内容"},model:{value:e.order_form_index.apiName,callback:function(t){e.$set(e.order_form_index,"apiName",t)},expression:"order_form_index.apiName"}})],1):e._e(),"index"==e.tabType?a("a-form-item",{attrs:{label:"服务描述："}},[a("a-input",{attrs:{placeholder:"请输入内容"},model:{value:e.order_form_index.apiDesc,callback:function(t){e.$set(e.order_form_index,"apiDesc",t)},expression:"order_form_index.apiDesc"}})],1):e._e(),"ser_approval"==e.tabType&&"3"!=e.tabKey&&"4"!=e.tabKey?a("a-form-item",{attrs:{label:"服务名称："}},[a("a-input",{attrs:{placeholder:"请输入内容"},model:{value:e.order_form.apiName,callback:function(t){e.$set(e.order_form,"apiName",t)},expression:"order_form.apiName"}})],1):e._e(),"ser_approval"==e.tabType&&"3"==e.tabKey?a("a-form-item",{attrs:{label:"应用名称："}},[a("a-input",{attrs:{placeholder:"请输入内容"},model:{value:e.order_form.apiName,callback:function(t){e.$set(e.order_form,"apiName",t)},expression:"order_form.apiName"}})],1):e._e(),"ser_approval"==e.tabType&&"4"==e.tabKey?a("a-form-item",{attrs:{label:"申请人"}},[a("a-input",{attrs:{placeholder:"请输入内容"},model:{value:e.order_form.apiName,callback:function(t){e.$set(e.order_form,"apiName",t)},expression:"order_form.apiName"}})],1):e._e(),"serInterface"==e.tabType?a("a-form-item",{attrs:{label:"关键字："}},[a("a-input",{attrs:{placeholder:"服务编号、名称、描述"},model:{value:e.order_form2.keyword,callback:function(t){e.$set(e.order_form2,"keyword",t)},expression:"order_form2.keyword"}})],1):e._e(),"serInterface"==e.tabType?a("a-form-item",{attrs:{label:"数据源："}},[a("a-select",{staticStyle:{width:"150px"},attrs:{"default-value":""},on:{change:e.onDatasourceChange}},[a("a-select-option",{attrs:{value:""}},[e._v("全部")]),e._l(e.apiDatasourceList,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.datasourceCode}},[e._v(e._s(t.datasourceName?t.datasourceName:"未知标识"))])}))],2)],1):e._e(),"serInterface"==e.tabType?a("a-form-item",{attrs:{label:"发布状态："}},[a("a-select",{staticStyle:{width:"100px"},attrs:{"default-value":""},on:{change:e.fbStatus}},[a("a-select-option",{attrs:{value:""}},[e._v("全部")]),a("a-select-option",{attrs:{value:"N"}},[e._v("未发布")]),a("a-select-option",{attrs:{value:"Y"}},[e._v("已发布")])],1)],1):e._e(),"ser_approval"==e.tabType&&3==e.tabKey?a("a-form-item",{attrs:{label:"申请类型："}},[a("a-select",{staticStyle:{width:"100px"},attrs:{"default-value":""},on:{change:e.appStatus}},[a("a-select-option",{attrs:{value:""}},[e._v("全部")]),a("a-select-option",{attrs:{value:"APP_APPLY"}},[e._v("应用创建")]),a("a-select-option",{attrs:{value:"APP_ALTER"}},[e._v("应用修改")])],1)],1):e._e(),"ser_approval"==e.tabType?a("a-form-item",{attrs:{label:"审批状态："}},[a("a-select",{staticStyle:{width:"100px"},attrs:{"default-value":"WAIT_AUDIT"},on:{change:e.spStatus}},[a("a-select-option",{attrs:{value:"WAIT_AUDIT"}},[e._v("待审批")]),a("a-select-option",{attrs:{value:"PASSED"}},[e._v("已通过")]),a("a-select-option",{attrs:{value:"REJECTED"}},[e._v("已驳回")]),a("a-select-option",{attrs:{value:"CANCELLED"}},[e._v("已撤回")]),a("a-select-option",{attrs:{value:""}},[e._v("全部")])],1)],1):e._e(),"serInterface"==e.tabType?a("a-form-item",{attrs:{label:"开放状态："}},[a("a-select",{staticStyle:{width:"100px"},attrs:{"default-value":""},on:{change:e.kfStatus}},[a("a-select-option",{attrs:{value:""}},[e._v("全部")]),a("a-select-option",{attrs:{value:"Y"}},[e._v("已开放")]),a("a-select-option",{attrs:{value:"N"}},[e._v("未开放")])],1)],1):e._e(),"serInterface"==e.tabType?a("a-form-item",{staticClass:"order_option_css",attrs:{label:"服务状态："}},[a("a-select",{staticStyle:{width:"100px"},attrs:{"default-value":"N"},on:{change:e.fwStatus}},[a("a-select-option",{attrs:{value:"N"}},[e._v("正常")]),a("a-select-option",{attrs:{value:"Y"}},[e._v("已销毁")])],1)],1):e._e(),"ser_approval"==e.tabType?a("a-form-item",{staticClass:"order_option_css",attrs:{label:"申请时间："}},[a("a-range-picker",{on:{change:e.time_rangeChange}},[a("a-icon",{attrs:{slot:"suffixIcon",type:"calendar"},slot:"suffixIcon"})],1)],1):e._e(),"index"==e.tabType?a("a-form-item",{staticClass:"order_option_css",attrs:{label:"时间："}},[a("a-range-picker",{on:{change:e.time_rangeChange}},[a("a-icon",{attrs:{slot:"suffixIcon",type:"calendar"},slot:"suffixIcon"})],1)],1):e._e(),"index"==e.tabType?a("a-form-item",{staticClass:"order_option_css",attrs:{label:"可调用的消费方："}},[a("a-select",{staticStyle:{width:"200px"},attrs:{"default-value":""},on:{change:e.canUseConsumer}},[a("a-select-option",{attrs:{value:""}},[e._v("全部")]),e._l(e.comsumerSelList,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.appId}},[e._v(e._s(t.appName))])}))],2)],1):e._e(),a("a-button",{staticClass:"order_option_css",attrs:{type:"primary","html-type":"submit"},on:{click:e.order_search}},[e._v("搜索")])],1)],1)])]),a("div",{staticClass:"consumer-components-table"},[a("a-table",{attrs:{columns:"index"==e.tabType?e.columns3:"ser_approval"==e.tabType?"3"==e.tabKey?e.colForAppAuthorization:"4"==e.tabKey?e.colForDevAuthorization:e.columns:e.colForApiManage,rowKey:function(e,t){return"consumer"+t},"data-source":e.tabData,pagination:e.pagination,scroll:{x:1e3}},scopedSlots:e._u([{key:"auditStatus",fn:function(t){return["PASSED"==t?a("span",[a("a-badge",{attrs:{status:"success"}}),e._v("已通过 ")],1):e._e(),"WAIT_AUDIT"==t?a("span",[a("a-badge",{attrs:{color:"geekblue"}}),e._v("待审批")],1):e._e(),"REJECTED"==t?a("span",[a("a-badge",{attrs:{status:"error"}}),e._v("已驳回 ")],1):e._e(),"CANCELLED"==t?a("span",[a("a-badge",{attrs:{status:"default"}}),e._v("已撤回 ")],1):e._e()]}},{key:"apiName",fn:function(t,i){return[a("span",{staticClass:"table-api-name",attrs:{title:i.apiDesc},on:{click:function(t){return e.detail(i)}}},[e._v(e._s(i.apiName))])]}},{key:"datasourceName",fn:function(t,i){return[a("span",{attrs:{title:i.datasourceName||"未知标识"}},[e._v(e._s(i.datasourceName||"未知标识"))])]}},{key:"appName",fn:function(t,i){return[a("span",{staticClass:"table-api-name",attrs:{title:i.appName},on:{click:function(t){return e.detail(i)}}},[e._v(e._s(i.appName))])]}},{key:"auditType",fn:function(t,a){return[e._v(" "+e._s("APP_APPLY"==a.auditType?"应用创建":"APP_ALTER"==a.auditType?"应用修改":"")+" ")]}},{key:"isPublish",fn:function(t,i){return"serInterface"==e.tabType?[a("a-switch",{attrs:{disabled:"N"!=i.isDestroy,"checked-children":"开","un-checked-children":"关"},on:{click:function(a){return e.isPublishChange(t,i)}},model:{value:i.isPublish,callback:function(t){e.$set(i,"isPublish",t)},expression:"record.isPublish"}})]:void 0}},{key:"isOpen",fn:function(t,i){return"serInterface"==e.tabType?[a("a-switch",{attrs:{disabled:"N"!=i.isDestroy,"checked-children":"开","un-checked-children":"关"},on:{change:function(a){return e.isOpenChange(t,i)}},model:{value:i.isOpen,callback:function(t){e.$set(i,"isOpen",t)},expression:"record.isOpen"}})]:void 0}},{key:"apiStatus",fn:function(t,i){return"index"==e.tabType?["已发布"==i.apiStatus?a("a-badge",{attrs:{status:"success",text:"已发布"}}):e._e(),"未发布"==i.apiStatus?a("a-badge",{attrs:{status:"error",text:"未发布"}}):e._e()]:void 0}},{key:"operation",fn:function(t,i){return["ser_approval"==e.tabType?a("span",[a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:"WAIT_AUDIT"!=i.auditStatus},on:{click:function(t){return e.approval_btn(i)}}},[e._v("审批")]),1==e.tabKey?a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link"},on:{click:function(t){return e.$api.serviceDetail.goToViewApiConfig(i.apiId,i.apiCode)}}},[e._v("查看")]):e._e()],1):e._e(),"serInterface"==e.tabType?a("span",[a("a-button",{staticStyle:{padding:"0","margin-right":"10px"},attrs:{type:"link",disabled:"N"!=i.isDestroy},on:{click:function(t){return e.give_btn(i)}}},[e._v("授权("+e._s(i.grantCount)+")")]),a("a-button",{staticStyle:{padding:"0"},style:"N"==i.isDestroy&&0==i.isPublish&&0==i.isOpen?"color:red":"",attrs:{disabled:"N"!=i.isDestroy||0!=i.isPublish||0!=i.isOpen,type:"link"},on:{click:function(t){return e.del_btn(i)}}},[e._v("销毁")]),a("a-button",{staticStyle:{padding:"0","margin-left":"10px"},attrs:{type:"link"},on:{click:function(t){return e.viewDevConfig(i)}}},[e._v("查看")])],1):e._e(),"index"==e.tabType&&"已发布"==i.apiStatus?a("span",[a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link"},on:{click:function(t){return e.apply_btn(i)}}},[e._v("申请调用")]),a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link"},on:{click:function(t){return e.testResult_btn(i)}}},[e._v("测试结果")])],1):e._e(),"index"==e.tabType&&"未发布"==i.apiStatus?a("span",[a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:""},on:{click:function(t){return e.apply_btn(i)}}},[e._v("申请调用")]),a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:""},on:{click:function(t){return e.testResult_btn(i)}}},[e._v("测试结果")])],1):e._e()]}},{key:"serveLevel",fn:function(t,i){return[a("a",{on:{click:function(t){return e.showServeLevel(i)}}},[e._v(e._s(t||"无"))])]}},{key:"operation2",fn:function(t,i){return"serInterface"==e.tabType?[a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:"N"!=i.isDestroy},on:{click:function(t){return e.controlStrategyBtn(i,{title:"并发配置",type:4})}}},[e._v("并发配置")]),a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:"N"!=i.isDestroy},on:{click:function(t){return e.controlStrategyBtn(i,{title:"限流配置",type:0})}}},[e._v("限流配置")]),a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:"N"!=i.isDestroy},on:{click:function(t){return e.controlStrategyBtn(i,{title:"熔断配置",type:5})}}},[e._v("熔断配置")]),a("a-button",{staticStyle:{"padding-left":"0"},attrs:{type:"link",disabled:"N"!=i.isDestroy},on:{click:function(t){return e.controlStrategyBtn(i,{title:"缓存配置",type:2})}}},[e._v("缓存配置")])]:void 0}}],null,!0)})],1),e.tepTwo?a("Approval",{attrs:{"step-type":2,auditId:e.auditId,tabKey:2,rowData:e.editRecord},on:{submitBtnFun:e.submitBtnFun}}):e._e(),e.isShow?a("Approval",{attrs:{"step-type":3,auditId:e.auditId,tabKey:parseInt(e.tabKey),rowData:e.editRecord,popData:e.popData},on:{submitBtnFun:e.submitBtnFun}}):e._e(),e.ModalGive?a("a-modal",{attrs:{maskClosable:!1,title:"授权","ok-text":"确认","cancel-text":"取消",width:"70%"},on:{ok:e.ModalGiveBtn},model:{value:e.ModalGive,callback:function(t){e.ModalGive=t},expression:"ModalGive"}},[a("AssociatedUser",{ref:"serGivePowerData",attrs:{"page-no":e.pageNo,"page-size":e.pageSize,total:e.total,"edit-record":e.editRecord,"open-type":e.openType},on:{closeModal:e.closeModal}})],1):e._e(),a("view-strateg",{attrs:{visible:e.controlStrategyModal,title:e.controlStrategyTitle,"strategy-form-data":e.strategyFormData},on:{"update:visible":function(t){e.controlStrategyModal=t}}}),a("a-modal",{attrs:{title:"编辑服务级别",visible:e.visibleServeLevel,"confirm-loading":e.confirmLoading,okText:"保存",maskClosable:!1,centered:!0},on:{ok:e.handleServeLevelOk,cancel:function(t){e.visibleServeLevel=!1}}},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.formServe,rules:e.ruleFormServeLevel,"label-col":{span:6},"wrapper-col":{span:14}}},[a("a-form-model-item",{ref:"serveLevel",attrs:{label:"服务级别",prop:"serveLevel"}},[a("a-select",{attrs:{placeholder:"请选择服务级别"},model:{value:e.formServe.serveLevel,callback:function(t){e.$set(e.formServe,"serveLevel",t)},expression:"formServe.serveLevel"}},[a("a-select-option",{attrs:{value:"T1"}},[e._v("T1")]),a("a-select-option",{attrs:{value:"T2"}},[e._v("T2")])],1)],1)],1)],1)],1)}),[],!1,null,"1fc44101",null).exports,c=(a("d3b7"),a("c7eb")),d=a("1da1"),u=(a("ac1f"),{name:"EditLimitRules",inheritAttrs:!1,props:{isAdd:{type:Boolean,default:!1},isAddDef:{type:Boolean,default:!1},baseInfo:{type:Object,default:function(){}},show:{type:Boolean,default:!0},title:{type:String,default:"新建规则"}},components:{},data:function(){return{rules:{flowName:[{required:!0,message:"请输入"}],unitTime:[{required:!0,message:"请输入"}],flowCount:[{required:!0,message:"请输入"}]},timeOptions:[{value:"s",name:"秒"}],labelCol:{lg:{span:6},sm:{span:6}},wrapperCol:{lg:{span:18},sm:{span:18}},visible:this.show,confirmLoading:!1,form:Object.assign({flowName:"",unitTime:"",unit:"s",flowCount:""},this.baseInfo)}},computed:{},created:function(){},mounted:function(){},watch:{},methods:{handleOk:function(){var e=this;return Object(d.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$refs.ruleForm.validate(function(){var t=Object(d.a)(Object(c.a)().mark((function t(a){var i,n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=31;break}if(e.confirmLoading=!0,i=Object.assign({},e.form),n=!1,t.prev=4,!e.isAdd){t.next=18;break}if(!e.isAddDef){t.next=12;break}return t.next=9,e.flowCtrlAddDef(i);case 9:t.t1=t.sent,t.next=15;break;case 12:return t.next=14,e.insert(i);case 14:t.t1=t.sent;case 15:t.t0=t.t1,t.next=21;break;case 18:return t.next=20,e.update(i);case 20:t.t0=t.sent;case 21:n=t.t0,e.confirmLoading=!1,t.next=28;break;case 25:t.prev=25,t.t2=t.catch(4),e.confirmLoading=!1;case 28:n&&(e.visible=!1,e.$emit("ok",i)),t.next=32;break;case 31:return t.abrupt("return",!1);case 32:case"end":return t.stop()}}),t,null,[[4,25]])})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},handleCancel:function(){this.visible=!1,this.$emit("cancel")},insert:function(e){var t=this;return Object(d.a)(Object(c.a)().mark((function a(){return Object(c.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$api.account.addFlow(e);case 2:if(a.sent.code){a.next=8;break}return t.$message.success("添加成功"),a.abrupt("return",!0);case 8:return a.abrupt("return",!1);case 9:case"end":return a.stop()}}),a)})))()},flowCtrlAddDef:function(e){var t=this;return Object(d.a)(Object(c.a)().mark((function a(){return Object(c.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$api.controlStrategy.flowCtrlAddDef(e);case 2:if(a.sent.code){a.next=8;break}return t.$message.success("添加成功"),a.abrupt("return",!0);case 8:return a.abrupt("return",!1);case 9:case"end":return a.stop()}}),a)})))()},update:function(e){var t=this;return Object(d.a)(Object(c.a)().mark((function a(){return Object(c.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$api.account.updateFlow(e);case 2:if(a.sent.code){a.next=8;break}return t.$message.success("修改成功"),a.abrupt("return",!0);case 8:return a.abrupt("return",!1);case 9:case"end":return a.stop()}}),a)})))()}}}),p=Object(r.a)(u,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{maskClosable:!1,"confirm-loading":e.confirmLoading,title:e.title,visible:e.visible,width:450},on:{cancel:e.handleCancel}},[a("template",{slot:"footer"},[a("a-row",[a("a-col",{staticStyle:{float:"right"},attrs:{span:9}},[a("a-button",{key:"back",on:{click:e.handleCancel}},[e._v(" 取消 ")]),a("a-button",{key:"submit",attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.handleOk}},[e._v(" 确定 ")])],1)],1)],1),a("a-form-model",{ref:"ruleForm",attrs:{"label-col":e.labelCol,model:e.form,rules:e.rules,"wrapper-col":e.wrapperCol}},[a("a-row",[a("a-col",[a("a-form-model-item",{attrs:{label:"规则名称",prop:"flowName"}},[a("a-input",{model:{value:e.form.flowName,callback:function(t){e.$set(e.form,"flowName",t)},expression:"form.flowName"}})],1)],1)],1),a("a-row",[a("a-col",[a("a-form-model-item",{attrs:{label:"单位时间",prop:"unitTime"}},[a("a-input",{staticStyle:{width:"100%"},model:{value:e.form.unitTime,callback:function(t){e.$set(e.form,"unitTime",t)},expression:"form.unitTime"}},[a("a-select",{staticStyle:{width:"80px"},attrs:{slot:"addonAfter"},slot:"addonAfter",model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.timeOptions,(function(t){return a("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1)],1)],1),a("a-row",[a("a-col",[a("a-form-model-item",{attrs:{label:"QPS阈值",prop:"flowCount"}},[a("a-input",{staticStyle:{width:"100%"},model:{value:e.form.flowCount,callback:function(t){e.$set(e.form,"flowCount",t)},expression:"form.flowCount"}})],1)],1)],1)],1)],2)}),[],!1,null,null,null).exports,h=a("2909"),f=(a("1276"),a("a434"),a("6062"),a("3ca3"),a("ddb0"),a("c740"),a("7db0"),a("4de4"),a("2ef0")),m=a.n(f),g={name:"ApiServer",inheritAttrs:!1,props:{baseInfo:{type:Object,default:function(){}},params:{type:Object,default:function(){}},show:{type:Boolean,default:!0},title:{type:String,default:"服务关联"}},components:{},data:function(){return{searchValueLeft:"",searchValueRight:"",autoExpandParentLeft:!0,autoExpandParentRight:!0,leftExpandedKeys:[],rightExpandedKeys:[],leftCheckedKeys:[],rightCheckedKeys:[],confirmLoading:!1,loading:!1,rules:{name:[{required:!0,message:"请输入"}]},labelCol:{lg:{span:6},sm:{span:6}},wrapperCol:{lg:{span:18},sm:{span:18}},visible:this.show,targetKeys:[],dataSource:[],leftTreeData:[],rightTreeData:[],leftFlatKeys:[],rightFlatDatas:[]}},computed:{toLeftBtnDisable:function(){return!this.rightCheckedKeys.length},toRightBtnDisable:function(){return!this.leftCheckedKeys.length}},created:function(){this.getDataFromServer()},mounted:function(){},watch:{},methods:{checkedLeft:function(e){this.leftCheckedKeys=e,this.rightCheckedKeys=[]},checkedRight:function(e){this.rightCheckedKeys=e,this.leftCheckedKeys=[]},onExpandLeft:function(e){this.leftExpandedKeys=e,this.autoExpandParentLeft=!1},onExpandRight:function(e){this.rightExpandedKeys=e,this.autoExpandParentRight=!1},getCheckParent:function(e){for(var t=e.length,a=[],i={},n=0;n<t;n++){var o=e[n],s=o&&o.split("-");if(s){var r=s[0];i[r]||(a.push(r),i[r]=!0)}}return a},toRight:function(){for(var e=this.leftCheckedKeys,t=e.length,a=this.leftFlatKeys,i=this.rightFlatKeys,n=0;n<t;n++){var o=e[n],s=a.indexOf(o);-1!=s&&~o.indexOf("-")&&a.splice(s,1),i.push(o)}this.leftFlatKeys=Object(h.a)(new Set(a)),this.rightFlatKeys=Object(h.a)(new Set(i)),this.refreshTree();var r=this.getCheckParent(e);this.rightExpandedKeys=Object(h.a)(new Set(r.concat(this.rightExpandedKeys))),this.autoExpandParentRight=!0},toLeft:function(){for(var e=this.rightCheckedKeys,t=e.length,a=this.leftFlatKeys,i=this.rightFlatKeys,n=0;n<t;n++){var o=e[n],s=i.indexOf(o);-1!=s&&~o.indexOf("-")&&i.splice(s,1),a.push(o)}this.leftFlatKeys=Object(h.a)(new Set(a)),this.rightFlatKeys=Object(h.a)(new Set(i)),this.refreshTree();var r=this.getCheckParent(e);this.leftExpandedKeys=Object(h.a)(new Set(r.concat(this.leftExpandedKeys))),this.autoExpandParentLeft=!0},refreshTree:function(){this.leftCheckedKeys=[],this.rightCheckedKeys=[],this.leftTreeData=this.getTreeByKeys(this.dataSource,this.leftFlatKeys),this.rightTreeData=this.getTreeByKeys(this.dataSource,this.rightFlatKeys)},getDataFromServer:function(){var e=this;return Object(d.a)(Object(c.a)().mark((function t(){var a,i,n,o,s,r,l,d,u,p,f,m;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=e.length,n=0;n<i;n++){var o=e[n],s=o.groupId,r=o.apiId,l=o.enabled,c={key:r?"".concat(s,"-").concat(r):"".concat(s),title:"".concat(o.apiName||o.groupName),enabled:l,groupId:s,groupName:o.groupName};if(r)c.apiId=r,c.parentId=s;else{c.parentId=-1;var d=!1;if(o.child&&o.child.length&&(d=-1==o.child.findIndex((function(e){return!e.enabled}))),!o.child||!o.child.length||d){c.disabled=!0;continue}}o.apiName&&(c.apiName=o.apiName),a(o.child,t),delete c.child,t.push(c)}},t.next=3,e.$api.account.getFlowApiList(e.params);case 3:for(i=t.sent,n=i&&i.data,o=n.left,s=n.right,l=[],a(o,r=[]),a(s,l),d=[].concat(r).concat(l),u={},p=[],f=d.length,m=0;m<f;m++)u[d[m].key]||(p.push(d[m]),u[d[m].key]=!0);e.dataSource=p,e.leftFlatKeys=Object(h.a)(new Set(r.map((function(e){if(!e.enabled)return e.key})))),e.rightFlatKeys=Object(h.a)(new Set(l.map((function(e){return e.key})))),e.leftTreeData=e.getTreeByKeys(p,e.leftFlatKeys),e.rightTreeData=e.getTreeByKeys(p,e.rightFlatKeys);case 20:case"end":return t.stop()}}),t)})))()},getTreeByKeys:function(e,t){for(var a=m.a.cloneDeep(e),i=m.a.cloneDeep(t),n=i.length,o=[],s={},r=function(){var e=i[l];if(!e)return"continue";var t=e.split("-");if(t.length>1){var n=t[0];s[n]||(s[n]=!0,o.push(a.find((function(e){return e.key==n}))))}s[e]||(s[e]=!0,o.push(a.find((function(t){return t.key==e}))))},l=0;l<n;l++)r();return this.treeDataTranslate(o)},treeDataTranslate:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",i=m.a.cloneDeep(e),n=[],o={},s=0;s<i.length;s++)o[i[s][t]]=i[s];for(var r=0;r<i.length;r++)if(o[i[r][a]]&&i[r][t]!==i[r][a])o[i[r][a]].children||(o[i[r][a]].children=[]),o[i[r][a]]._level||(o[i[r][a]]._level=1),i[r]._level=o[i[r][a]]._level+1,o[i[r][a]].children.push(i[r]);else{var l=i[r];!l.enabled&&n.push(l)}return n.filter((function(e){return e.children&&e.children.length}))},handleSearch:function(e,t){for(var a=this,i="L"==t?this.leftTreeData:this.rightTreeData,n="L"==t?this.leftFlatKeys:this.rightFlatKeys,o=[],s=n.length,r=function(e){var t=a.dataSource.find((function(t){return t.key==n[e]}));t&&o.push(t)},l=0;l<s;l++)r(l);var c=e.target.value,d=o.map((function(e){return e.title.indexOf(c)>-1?function e(t,a){for(var i,n=0;n<a.length;n++){var o=a[n];o.children?o.children.some((function(e){return e.key==t}))?i="".concat(o.key):e(t,o.children)&&(i=e(t,o.children)):o.key==t&&(i="".concat(o.key))}return i}(e.key,i):null})).filter((function(e,t,a){return e&&a.indexOf(e)===t}));"L"==t?(this.leftExpandedKeys=d,this.searchValueLeft=c,this.autoExpandParentLeft=!0):(this.rightExpandedKeys=d,this.searchValueRight=c,this.autoExpandParentRight=!0)},handleOk:function(){var e=this;return Object(d.a)(Object(c.a)().mark((function t(){var a,i,n,o,s,r;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e.visible=!1,a=[],i=e.rightFlatKeys,n=i.length,o=0;o<n;o++)s=i[o],r=s.split("-"),r.length>1&&a.push(r[1]);return e.confirmLoading=!0,t.next=8,e.$api.account.saveFlowApi(Object.assign({},e.params,{apiId:a}));case 8:0===t.sent.code&&e.$message.success("保存成功"),e.confirmLoading=!1,e.$emit("ok");case 12:case"end":return t.stop()}}),t)})))()},handleCancel:function(){this.visible=!1,this.$emit("cancel")}}},y=(a("b0f1"),Object(r.a)(g,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{"confirm-loading":e.confirmLoading,maskClosable:!1,title:e.title,visible:e.visible,width:700},on:{cancel:e.handleCancel,ok:e.handleOk}},[a("a-row",[a("a-col",{attrs:{span:11}},[a("a-card",{attrs:{title:""}},[a("a-input-search",{staticStyle:{"margin-bottom":"8px"},attrs:{placeholder:"搜索可关联API"},on:{change:function(t){return e.handleSearch(t,"L")}}}),a("a-tree",{key:"leftTreeKey",ref:"leftTree",attrs:{blockNode:"",defaultExpandAll:"",checkable:"",expandedKeys:e.leftExpandedKeys,checkedKeys:e.leftCheckedKeys,"auto-expand-parent":e.autoExpandParentLeft,treeData:e.leftTreeData},on:{expand:e.onExpandLeft,check:e.checkedLeft},scopedSlots:e._u([{key:"title",fn:function(t){var i=t.title;return[i.indexOf(e.searchValueLeft)>-1?a("span",[e._v(" "+e._s(i.substr(0,i.indexOf(e.searchValueLeft)))+" "),a("span",{staticStyle:{color:"#ff5500"}},[e._v(e._s(e.searchValueLeft))]),e._v(" "+e._s(i.substr(i.indexOf(e.searchValueLeft)+e.searchValueLeft.length))+" ")]):a("span",[e._v(e._s(i))])]}}])})],1)],1),a("a-col",{attrs:{span:2}},[a("div",{staticClass:"space-between"},[a("a-button",{key:"add2Right",attrs:{type:"primary",size:"small",disabled:e.toRightBtnDisable},on:{click:e.toRight}},[e._v(" > ")]),a("br"),a("a-button",{key:"add2Left",attrs:{type:"primary",size:"small",disabled:e.toLeftBtnDisable},on:{click:e.toLeft}},[e._v(" < ")])],1)]),a("a-col",{attrs:{span:11}},[a("a-card",{attrs:{title:""}},[a("a-input-search",{staticStyle:{"margin-bottom":"8px"},attrs:{placeholder:"搜索已关联API"},on:{change:function(t){return e.handleSearch(t,"R")}}}),a("a-tree",{key:"rightTreeKey",ref:"rightTree",attrs:{blockNode:"",defaultExpandAll:"",checkable:"",expandedKeys:e.rightExpandedKeys,checkedKeys:e.rightCheckedKeys,"auto-expand-parent":e.autoExpandParentRight,treeData:e.rightTreeData},on:{expand:e.onExpandRight,check:e.checkedRight},scopedSlots:e._u([{key:"title",fn:function(t){var i=t.title;return[i.indexOf(e.searchValueRight)>-1?a("span",[e._v(" "+e._s(i.substr(0,i.indexOf(e.searchValueRight)))+" "),a("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValueRight))]),e._v(" "+e._s(i.substr(i.indexOf(e.searchValueRight)+e.searchValueRight.length))+" ")]):a("span",[e._v(e._s(i))])]}}])})],1)],1)],1)],1)}),[],!1,null,"41749e7a",null).exports),b=0,v={name:"LimitRules",inject:["reload"],mixins:[{data:function(){return{curComponent:null,curComponentOption:{isAdd:!1,show:!1,title:""},currentPage:1,totalPage:3,pageNo:1,pageSize:10,total:0,totalNum:0,batchDelData:[],tabData:[]}},computed:{rowSelection:function(){var e=this;return{onChange:function(t,a){e.batchDelData=a}}},pagination:function(){var e=this;Math.ceil(e.total/e.pageSize);return{showSizeChanger:!0,size:"small",pageSizeOptions:["10","20","50","100"],showQuickJumper:!0,pageSize:e.pageSize,total:e.totalNum,current:e.pageNo,showTotal:function(t){return"共 ".concat(e.total," 条")},onChange:function(t,a){e.pageNo=t,e.pageSize=a,e.getListFromServer()},onShowSizeChange:function(t,a){e.pageNo=1,e.pageSize=a,e.getListFromServer()}}},count:function(){return!this.expand}},created:function(){this.getListFromServer()},methods:{setCurComponentOption:function(e){var t=e.component,a=e.title,i=e.isShow,n=e.baseInfo,o=e.isAdd,s=void 0!==o&&o,r=e.associateInfo,l=e.params,c=e.isAddDef,d=e.defaultRule,u=e.recordSp;this.curComponentOption.title=a,this.curComponentOption.isAdd=s,this.curComponentOption.baseInfo=n,this.curComponent=t,this.curComponentOption.associateInfo=r,this.curComponentOption.params=l,this.curComponentOption.show=i,this.curComponentOption.isAddDef=c,this.curComponentOption.defaultRule=d,this.curComponentOption.recordSp=u},okHandle:function(){this.cancelHandle(),this.refresh()},refresh:function(){this.getListFromServer()},cancelHandle:function(){this.curComponent=null,this.curComponentOption.show=!1},searchInput:function(){this.pageNo=1,this.getListFromServer()},resetClick:function(){this.reload()},batchDel:function(e){var t=this;0===this.batchDelData.length?this.$message.warning("请勾选数据"):i.a.confirm({title:this.$t("批量删除"),content:this.$t("当前操作会删除已勾选数据，是否继续？"),onOk:function(){var a=[];t.batchDelData.map((function(t){a.push(t[e])})),t.deleteDataById(a)},onCancel:function(){}})},delSingle:function(e,t){var a=this;i.a.confirm({title:this.$t("确定要删除这行记录吗?"),icon:function(){return a.$createElement("a-icon",{props:{type:"exclamation-circle",theme:"filled"}})},onOk:function(){var i=[];i.push(e[t]),a.deleteDataById(i)},onCancel:function(){}})}}}],data:function(){return{dataModalTotal:10,recordSp:"",defaultRule:"",spPageNo:1,spPageSize:10,unboundName:"",unboundType:"",visibleDataSource:!1,visibleDataSourceEdit:!1,modalTitle:"",flowName:"",createBy:"",columns:[{title:"规则ID",dataIndex:"flowId",key:"flowId",width:100},{title:"规则名称",dataIndex:"flowName",key:"flowName",width:120},{title:"时间/s",dataIndex:"unitTime",key:"unitTime",width:100},{title:"阈值",dataIndex:"flowCount",key:"flowCount",width:100},{title:"关联数",dataIndex:"apiCount",key:"apiCount",width:100},{title:"修改时间",dataIndex:"updateTime",key:"updateTime",width:180},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:200}],columnsModal:[{title:"应用ID",dataIndex:"appId",key:"appId",width:100},{title:"应用名称",dataIndex:"appName",key:"appName",width:200},{title:"应用限流值",dataIndex:"appFlowCount",key:"appFlowCount",width:120},{title:"最后修改人",key:"updateBy",dataIndex:"updateBy",width:150},{title:"最后修改时间",key:"updateTime",dataIndex:"updateTime",width:200},{title:"操作",key:"action",scopedSlots:{customRender:"action"},width:200}],dataModal:[]}},computed:{hasDefaultRule:function(){return this.tabData.some((function(e){return"Y"==e.defaultRule}))}},methods:{getListFromServer:function(){var e=this,t={name:this.flowName,userName:this.createBy,pageNum:this.pageNo,pageSize:this.pageSize};this.$api.account.getflowList(t).then((function(t){e.tabData=t.data.list,e.total=t.data.total,e.totalNum=t.data.total}))},addPopup:function(){this.setCurComponentOption({component:p,title:"新建规则",isShow:!0,baseInfo:null,isAdd:!0,isAddDef:!1})},editPopup:function(e){this.setCurComponentOption({component:p,title:"编辑规则",isShow:!0,baseInfo:e,isAdd:!1,isAddDef:!1})},associatedServer:function(e){this.setCurComponentOption({component:y,title:"关联API",isShow:!0,baseInfo:e,params:{type:b,id:e.flowId}})},delFlowRule:function(e){var t=this.$api.account.deleteFolw(e.flowId);this.$message.success(t.data),this.reload()}}},_=(a("5c15"),Object(r.a)(v,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"consumer-components-box"},[a("div",{staticClass:"consumer-components-head"},[a("div",{staticClass:"consumer-components-head-top"},[a("a-row",[e._v(" 规则名称："),a("a-input",{staticClass:"consumer-components-input",attrs:{placeholder:"请输入名称"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchInput(t)}},model:{value:e.flowName,callback:function(t){e.flowName=t},expression:"flowName"}}),a("a-button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:e.searchInput}},[e._v("查询")]),a("a-button",{on:{click:e.addPopup}},[e._v("+ 新建")])],1)],1),a("div",{staticClass:"consumer-components-head-bottom"})]),a("div",{staticClass:"consumer-components-table"},[a("a-table",{attrs:{columns:e.columns,"data-source":e.tabData,pagination:e.pagination,scroll:{x:1e3}},scopedSlots:e._u([{key:"operation",fn:function(t,i){return[a("a-button",{staticClass:"btnClass",attrs:{type:"link"},on:{click:function(t){return e.editPopup(i)}}},[e._v("编辑")]),"Y"==i.defaultRule?a("span",{staticStyle:{margin:"0 5px",color:"#bec3c8"}},[e._v("关联API")]):a("a-button",{staticClass:"btnClass",attrs:{type:"link"},on:{click:function(t){return e.associatedServer(i)}}},[e._v("关联API")]),a("a-button",{staticClass:"btnClass",staticStyle:{color:"red"},attrs:{type:"link"},on:{click:function(t){return e.delFlowRule(i)}}},[e._v("删除")])]}}])})],1),e.curComponentOption.show?a(e.curComponent,e._b({tag:"component",on:{cancel:e.cancelHandle,ok:e.okHandle}},"component",e.curComponentOption,!1)):e._e()],1)}),[],!1,null,"6ad9cea0",null).exports),S={name:"Tactics",components:{serApprovalComponents:l},data:function(){return{key:"1",tabs:[{key:"1",tabName:"限流规则",curComponent:_}]}},created:function(){var e=sessionStorage.getItem("ControlStrategyKey");e&&(this.key=e),this.showPage(this.key)},methods:{change:function(e){this.key=e,this.showPage(e),sessionStorage.setItem("ControlStrategyKey",e)},showPage:function(e){"1"==e?(this.isFirst=!0,this.isSecond=!1):"2"==e&&(this.isFirst=!1,this.isSecond=!0)}}},k=(a("7504"),Object(r.a)(S,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"jurisdiction-box"},[t("a-tabs",{staticClass:"tab_css",attrs:{defaultActiveKey:this.key},on:{change:this.change}},this._l(this.tabs,(function(e){return t("a-tab-pane",{key:e.key,attrs:{tab:e.tabName}},[t(e.curComponent,{tag:"component"})],1)})),1)],1)}),[],!1,null,"9c3fcc28",null));t.default=k.exports},5118:function(e,t,a){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(n.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(n.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},a("6017"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,a("c8ba"))},"531f":function(e,t,a){},"5c15":function(e,t,a){"use strict";a("d412")},6017:function(e,t,a){(function(e,t){!function(e,a){"use strict";if(!e.setImmediate){var i,n,o,s,r,l=1,c={},d=!1,u=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,a=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=a,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){f(e.data)},i=function(e){o.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(n=u.documentElement,i=function(e){var t=u.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):i=function(e){setTimeout(f,0,e)}:(s="setImmediate$"+Math.random()+"$",r=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&f(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),i=function(t){e.postMessage(s+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var n={callback:e,args:t};return c[l]=n,i(l),l++},p.clearImmediate=h}function h(e){delete c[e]}function f(e){if(d)setTimeout(f,0,e);else{var t=c[e];if(t){d=!0;try{!function(e){var t=e.callback,a=e.args;switch(a.length){case 0:t();break;case 1:t(a[0]);break;case 2:t(a[0],a[1]);break;case 3:t(a[0],a[1],a[2]);break;default:t.apply(void 0,a)}}(t)}finally{h(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,a("c8ba"),a("4362"))},7504:function(e,t,a){"use strict";a("531f")},b0f1:function(e,t,a){"use strict";a("be37")},be37:function(e,t,a){},ceac:function(e,t,a){var i=a("2eaa"),n=a("5c69"),o=a("100e"),s=a("dcbe"),r=o((function(e,t){return s(e)?i(e,n(t,1,s,!0)):[]}));e.exports=r},d412:function(e,t,a){},f861:function(e,t,a){}}]);